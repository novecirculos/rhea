import React from 'react';
import { Button } from '@novecirculos/button-feature';
import { novecirculosProvider } from '@novecirculos/context';
import { useToast } from '@novecirculos/toast-context';
import { Scaffold } from '../../../components/Scaffold';
import { use<%= props.pascalCaseName %>Mutation } from '@novecirculos/<%= props.kebabCaseParent %>-network';
import { z } from 'zod';
import ReactJson from 'react-json-view';

interface Args {
  email: string;
}

interface ComponentProps {
  args: Args;
}

export default {
  title: 'Network/<%= props.pascalCaseParent %>/Mutations/use<%= props.pascalCaseName %>Mutation',
};

export const Default = (args: Args) => {
  return (
    <Scaffold>
      <ComponentUsing<%= props.pascalCaseName %> args={args} />
    </Scaffold>
  );
};

Default.args = {
  email: '',
};

const validationSchema = z.object({
  email: z.string().email(),
});

const ComponentUsing<%= props.pascalCaseName %> = ({ args }: ComponentProps) => {
  const { mutateAsync, data } = use<%= props.pascalCaseName %>Mutation();
  const { addToast } = useToast();

  const onPressRequestPassword = () => {
    try {
      const submitArgs = validationSchema.parse(args);
      mutateAsync(submitArgs)
        .then(() => {
          addToast({
            text: 'Successfully requested password reset.',
            variant: 'success',
          });
        })
        .catch((err: Error) => {
          addToast({
            text: err.message,
            variant: 'error',
          });
        });
    } catch (err) {
      addToast({
        text: 'Invalid email address. Edit using the controls panel.',
        variant: 'error',
      });
    }
  };

  return (
    <div className="flex h-screen w-full justify-center items-center">
      <main className="max-w-2xl flex flex-col gap-2">
        <section>
          <h1 className="text-white text-center">
            This is the <%= props.pascalCaseParent %> package. Use the storybook controls to
            interact with it.
          </h1>
          <Button text="Request Password" onPress={onPressRequestPassword} />
        </section>
        <ReactJson theme="google" src={data ?? {}} />
      </main>
    </div>
  );
};
