import React from 'react';
import { Button } from '@novecirculos/button-feature';
import { use<%= props.pascalCaseName %>Network } from '@novecirculos/<%= props.kebabCaseName %>-network';
import { novecirculosProvider } from '@novecirculos/context';
import { useToast } from '@novecirculos/toast-context';
import { Scaffold } from '../../../components/Scaffold';
import { AuthEnsurer } from '../components/AuthEnsurer';

interface Args {
  username: string;
  password: string;
  authToken?: string
}

interface ComponentProps {
  args: Args;
}

export default {
  title: 'Network/<%= props.pascalCaseName %>/Hooks/use<%= props.pascalCaseName %>Network',
  argTypes: {
    username: {
      control: 'text',
    },
    password: {
      control: 'text',
    },
  },
};

export const Default = (args: Args) => {
  return (
    <Scaffold>
      <AuthEnsurer authToken={args.authToken}>
        <ComponentUsing<%= props.pascalCaseName %> args={args} />
      </AuthEnsurer>
    </Scaffold>
  );
};

Default.args = {
  username: 'premium.mh',
  password: 'password',
};

const ComponentUsing<%= props.pascalCaseName %> = ({ args }: ComponentProps) => {
  const { token, logout, login, loading } = use<%= props.pascalCaseName %>Network();
  const { addToast } = useToast();

  const onPressAuthenticate = () => {
    login(args)
      .then(() =>
        addToast({
          text: 'Successfully logged in',
          variant: 'success',
        })
      )
      .catch((err: Error) => {
        addToast({
          text: err.message,
          variant: 'error',
        });
      });
  };

  return (
    <>
        <section>
          <h1 className="text-white text-center">
            This is the <%= props.pascalCaseName %> package. Use the storybook controls to
            interact with it.
          </h1>
          <Button
            text="Authenticate"
            loading={loading}
            onPress={onPressAuthenticate}
          />
        </section>
        {token?.access_token && (
          <section>
            <h1 className="text-white text-center">Authenticated!</h1>
            <Button text="Logout" variant="tertiary" onPress={logout} />
          </section>
        )}
    </>
  );
};
